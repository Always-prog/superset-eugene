

# Скрипт для синхронизации описаний метрик - sync_metrics.py

Скрипт sync_metrics.py предназначен для интеграции с **Apache Superset** и автоматического обновления описаний метрик в таблице `sql_metrics`, которая хранит метрики для Superset. Описания метрик извлекаются из внешней базы данных, содержащей соответствующую таблицу метрик, и переносятся в Superset по соответствию имён метрик.

## Требования
  База данных с таблицей метрик для хранения внешних описаний метрик. Таблица должна содержать поля name и description, где:<br/>
  name - уникальное название метрики в Суперсет. <br/>
  description - описание метрики

## Настройка

Перед использованием скрипта, настройте строки подключения к вашим базам данных:

- **`DESC_DATABASE_URI`** — строка подключения к базе данных, в которой хранится таблица `metrics` с описаниями метрик.
- **`DATABASE_URI`** — строка подключения к базе данных **Apache Superset**, где хранится таблица `sql_metrics`.

Эти строки можно настроить в скрипте следующим образом в начале скрипта (они уже есть по умолчанию):

```python
DESC_DATABASE_URI = (
    f"postgresql://"
    f"superset:superset@"
    f"localhost:5432/external_metrics"
)
METRICS_TABLE_NAME = 'metrics'
DATABASE_URI = (
    f"postgresql://"
    f"superset:superset@"
    f"localhost:5432/superset"
)
```

## Использование

Для синхронизации описаний метрик из внешней базы данных в **Apache Superset**, выполните следующие шаги:

1. Убедитесь, что Superset настроен и работает с PostgreSQL в качестве базы данных.
2. Запустите скрипт:
```bash
python sync_metrics.py
```

### Пример работы

Скрипт выполнит следующие шаги:
1. Подключится к внешней базе данных и получит метрики с их описаниями из таблицы `metrics`.
2. Обновит записи в таблице `sql_metrics` Apache Superset на основе совпадения метрик по имени.

В результате выполнения скрипта в консоли будут выводиться уведомления об обновлённых метриках:
```bash
Updated metric 'sales_total' with new description.
Metric 'page_views' not found in sql_metrics.
```

### Рекомендации

Этот скрипт можно настроить для регулярного выполнения, чтобы автоматически синхронизировать метрики из внешней системы в Superset, например, с помощью cron-задач или в процессе CI/CD.

